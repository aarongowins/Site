(function(f){"object"==typeof exports&&"object"==typeof module?f(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],f):f(CodeMirror)})(function(f){function r(e,b){if(!e.hasOwnProperty(b))throw Error("Undefined state "+b+"in simple mode");}function n(e,b){if(!e)return/(?:)/;var h="";e instanceof RegExp?(e.ignoreCase&&(h="i"),e=e.source):e=String(e);return RegExp((!1===b?"":"^")+"(?:"+e+")",h)}function v(e,b){if(e.next||e.push)r(b,e.next||e.push);
this.regex=n(e.regex);var h;if(h=e.token)if("string"==typeof h)h=h.replace(/\./g," ");else{for(var j=[],f=0;f<h.length;f++)j.push(h[f]&&h[f].replace(/\./g," "));h=j}else h=null;this.token=h;this.data=e}function t(e,b){if(e===b)return!0;if(!e||"object"!=typeof e||!b||"object"!=typeof b)return!1;var h=0,f;for(f in e)if(e.hasOwnProperty(f)){if(!b.hasOwnProperty(f)||!t(e[f],b[f]))return!1;h++}for(f in b)b.hasOwnProperty(f)&&h--;return 0==h}f.defineSimpleMode=function(e,b){f.defineMode(e,function(e){return f.simpleMode(e,
b)})};f.simpleMode=function(e,b){r(b,"start");var h={},j=b.meta||{},s=!1,i;for(i in b)if(i!=j&&b.hasOwnProperty(i))for(var w=h[i]=[],u=b[i],o=0;o<u.length;o++){var p=u[o];w.push(new v(p,b));if(p.indent||p.dedent)s=!0}i={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:s?[]:null}},copyState:function(d){var c={state:d.state,pending:d.pending,local:d.local,localState:null,indent:d.indent&&d.indent.slice(0)};d.localState&&(c.localState=f.copyState(d.local.mode,
d.localState));d.stack&&(c.stack=d.stack.slice(0));for(var a=d.persistentStates;a;a=a.next)c.persistentStates={mode:a.mode,spec:a.spec,state:a.state==d.localState?c.localState:f.copyState(a.mode,a.state),next:c.persistentStates};return c},token:function(d,c){if(c.pending){var a=c.pending.shift();0==c.pending.length&&(c.pending=null);d.pos+=a.text.length;return a.token}if(c.local){if(c.local.end&&d.match(c.local.end))a=c.local.endToken||null,c.local=c.localState=null;else{var a=c.local.mode.token(d,
c.localState),b;if(c.local.endScan&&(b=c.local.endScan.exec(d.current())))d.pos=d.start+b.index}return a}for(var k=h[c.state],g=0;g<k.length;g++)if(a=k[g],b=(!a.data.sol||d.sol())&&d.match(a.regex)){a.data.next?c.state=a.data.next:a.data.push?((c.stack||(c.stack=[])).push(c.state),c.state=a.data.push):a.data.pop&&(c.stack&&c.stack.length)&&(c.state=c.stack.pop());if(a.data.mode){var j=e,k=c,g=a.data.mode,i=a.token,m=void 0;if(g.persistent)for(var l=k.persistentStates;l&&!m;l=l.next)if(g.spec?t(g.spec,
l.spec):g.mode==l.mode)m=l;j=m?m.mode:g.mode||f.getMode(j,g.spec);l=m?m.state:f.startState(j);g.persistent&&!m&&(k.persistentStates={mode:j,spec:g.spec,state:l,next:k.persistentStates});k.localState=l;k.local={mode:j,end:g.end&&n(g.end),endScan:g.end&&!1!==g.forceEnd&&n(g.end,!1),endToken:i&&i.join?i[i.length-1]:i}}a.data.indent&&c.indent.push(d.indentation()+e.indentUnit);a.data.dedent&&c.indent.pop();if(2<b.length){c.pending=[];for(k=2;k<b.length;k++)b[k]&&c.pending.push({text:b[k],token:a.token[k-
1]});d.backUp(b[0].length-(b[1]?b[1].length:0));return a.token[0]}return a.token&&a.token.join?a.token[0]:a.token}d.next();return null},innerMode:function(d){return d.local&&{mode:d.local.mode,state:d.localState}},indent:function(d,c,a){if(d.local&&d.local.mode.indent)return d.local.mode.indent(d.localState,c,a);if(!(a=null==d.indent))if(!(a=d.local))if(a=j.dontIndentStates){a:{for(var a=j.dontIndentStates,b=0;b<a.length;b++)if(a[b]===d.state){a=!0;break a}a=void 0}a=-1<a}if(a)return f.Pass;a=d.indent.length-
1;b=h[d.state];a:for(;;){for(var e=0;e<b.length;e++){var g=b[e];if(g.data.dedent&&!1!==g.data.dedentIfLineStart){var i=g.regex.exec(c);if(i&&i[0]){a--;if(g.next||g.push)b=h[g.next||g.push];c=c.slice(i[0].length);continue a}}}break}return 0>a?0:d.indent[a]}};if(j)for(var q in j)j.hasOwnProperty(q)&&(i[q]=j[q]);return i}});