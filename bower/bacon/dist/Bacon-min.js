(function(){var e,za,k,fa,Aa,ma,ga,na,D,P,v,Q,R,Y,w,E,Ba,K,z,A,oa,S,Ca,Da,Z,Ea,Fa,Ga,pa,Ha,Ia,T,s,r,Ja,qa,ha,Ka,La,ia,B,ja,t,U,ka,F,ra,sa,$,G,q,ta,aa,V,ba,ca,la,Ma,Na,ua,Oa,h,va,l,Pa={}.hasOwnProperty,i=[].slice,o=function(a,b){function c(){this.constructor=a}for(var d in b)Pa.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},L=function(a,b){return function(){return a.apply(b,arguments)}};e={toString:function(){return"Bacon"},version:"0.7.42"};Q=("undefined"!==
typeof global&&null!==global?global:this).Error;l={indexOf:Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){var c,d,e,f;c=e=0;for(f=a.length;e<f;c=++e)if(d=a[c],b===d)return c;return-1},indexWhere:function(a,b){var c,d,e,f;c=e=0;for(f=a.length;e<f;c=++e)if(d=a[c],b(d))return c;return-1},head:function(a){return a[0]},always:function(a){return function(){return a}},negate:function(a){return function(b){return!a(b)}},empty:function(a){return 0===a.length},tail:function(a){return a.slice(1,
a.length)},filter:function(a,b){var c,d,e,f;c=[];e=0;for(f=b.length;e<f;e++)d=b[e],a(d)&&c.push(d);return c},map:function(a,b){var c,d,e,f;f=[];d=0;for(e=b.length;d<e;d++)c=b[d],f.push(a(c));return f},each:function(a,b){var c,d;for(c in a)d=a[c],b(c,d)},toArray:function(a){return B(a)?a:[a]},contains:function(a,b){return-1!==l.indexOf(a,b)},id:function(a){return a},last:function(a){return a[a.length-1]},all:function(a,b){var c,d,e;null==b&&(b=l.id);d=0;for(e=a.length;d<e;d++)if(c=a[d],!b(c))return!1;
return!0},any:function(a,b){var c,d,e;null==b&&(b=l.id);d=0;for(e=a.length;d<e;d++)if(c=a[d],b(c))return!0;return!1},without:function(a,b){return l.filter(function(b){return b!==a},b)},remove:function(a,b){var c;c=l.indexOf(b,a);if(0<=c)return b.splice(c,1)},fold:function(a,b,c){var d,e,f;e=0;for(f=a.length;e<f;e++)d=a[e],b=c(b,d);return b},flatMap:function(a,b){return l.fold(b,[],function(b,d){return b.concat(a(d))})},cached:function(a){var b;b=w;return function(){b===w&&(b=a(),a=void 0);return b}},
toString:function(a){var b,c,d;try{aa++;if(null==a)return"undefined";if(t(a))return"function";if(B(a))return 5<aa?"[..]":"["+l.map(l.toString,a).toString()+"]";if(null!=(null!=a?a.toString:void 0)&&a.toString!==Object.prototype.toString)return a.toString();if("object"===typeof a){if(5<aa)return"{..}";var e;e=[];for(c in a)if(Pa.call(a,c)){try{d=a[c]}catch(f){d=b=f}e.push(l.toString(c)+":"+l.toString(d))}return"{"+e+"}"}return a}finally{aa--}}};aa=0;e._=l;e.scheduler={setTimeout:function(a,b){return setTimeout(a,
b)},setInterval:function(a,b){return setInterval(a,b)},clearInterval:function(a){return clearInterval(a)},now:function(){return(new Date).getTime()}};e.fromBinder=function(a,b){null==b&&(b=l.id);return new v(s(e,"fromBinder",a,b),function(c){var d,g,f,m;d=m=false;g=function(){if(!m){if(typeof f!=="undefined"&&f!==null){f();return m=true}return d=true}};f=a(function(){var a,d,f,m,h;a=1<=arguments.length?i.call(arguments,0):[];f=b.apply(this,a);B(f)&&l.last(f)instanceof P||(f=[f]);d=e.more;m=0;for(h=
f.length;m<h;m++){a=f[m];d=c(a=la(a));if(d===e.noMore||a.isEnd()){g();break}}return d});d&&g();return g})};e.$={};e.$.asEventStream=function(a,b,c){var d;t(b)&&(d=[b,void 0],c=d[0],b=d[1]);return h(this.selector||this,"asEventStream",a,e.fromBinder(function(c){return function(d){c.on(a,b,d);return function(){return c.off(a,b,d)}}}(this),c))};if(null!=(k="undefined"!==typeof jQuery&&null!==jQuery?jQuery:"undefined"!==typeof Zepto&&null!==Zepto?Zepto:void 0))k.fn.asEventStream=e.$.asEventStream;e.fromEventTarget=
function(a,b,c){var d,g,f,m,j,l,i,Qa;d=null!=(f=null!=(m=null!=(j=a.addEventListener)?j:a.addListener)?m:a.bind)?f:a.on;g=null!=(l=null!=(i=null!=(Qa=a.removeEventListener)?Qa:a.removeListener)?i:a.unbind)?l:a.off;return h(e,"fromEventTarget",a,b,e.fromBinder(function(c){d.call(a,b,c);return function(){return g.call(a,b,c)}},c))};e.fromPromise=function(a,b){return h(e,"fromPromise",a,e.fromBinder(function(c){a.then(c,function(a){return c(D(a))});return function(){if(b)return"function"===typeof a.abort?
a.abort():void 0}},function(a){return[a,r()]}))};e.noMore=["<no-more>"];e.more=["<more>"];e.later=function(a,b){return h(e,"later",a,b,e.fromPoll(a,function(){return[b,r()]}))};e.sequentially=function(a,b){var c;c=0;return h(e,"sequentially",a,b,e.fromPoll(a,function(){var a;a=b[c++];return c<b.length?a:c===b.length?[a,r()]:r()}))};e.repeatedly=function(a,b){var c;c=0;return h(e,"repeatedly",a,b,e.fromPoll(a,function(){return b[c++%b.length]}))};e.spy=function(a){return ba.push(a)};ba=[];V=function(a){var b,
c,d;if(ba.length&&!V.running)try{V.running=!0;c=0;for(d=ba.length;c<d;c++)b=ba[c],b(a)}finally{delete V.running}};va=function(a){return function(){var b,c,d,e;d=arguments[0];b=2<=arguments.length?i.call(arguments,1):[];"object"===typeof d&&b.length&&(c=d,e=b[0],d=function(){return c[e].apply(c,arguments)},b=b.slice(1));return a.apply(null,[d].concat(i.call(b)))}};k=function(a,b){return va(function(){var c,d,g;d=arguments[0];c=2<=arguments.length?i.call(arguments,1):[];g=ta(b,[function(a,b){return d.apply(null,
i.call(a).concat([b]))}]);return h.apply(null,[e,a,d].concat(i.call(c),[e.combineAsArray(c).flatMap(g)]))})};e.fromCallback=k("fromCallback",function(){var a,b;b=arguments[0];a=2<=arguments.length?i.call(arguments,1):[];return e.fromBinder(function(c){ka(b,a)(c);return q},function(a){return[a,r()]})});e.fromNodeCallback=k("fromNodeCallback",function(){var a,b;b=arguments[0];a=2<=arguments.length?i.call(arguments,1):[];return e.fromBinder(function(c){ka(b,a)(c);return q},function(a,b){return a?[D(a),
r()]:[b,r()]})});e.fromPoll=function(a,b){return h(e,"fromPoll",a,b,e.fromBinder(function(b){var d;d=e.scheduler.setInterval(b,a);return function(){return e.scheduler.clearInterval(d)}},b))};e.interval=function(a,b){null==b&&(b={});return h(e,"interval",a,b,e.fromPoll(a,function(){return G(b)}))};e.constant=function(a){return new E(s(e,"constant",a),function(b){b(ia(a));b(r());return q})};e.never=function(){return new v(s(e,"never"),function(a){a(r());return q})};e.once=function(a){return new v(s(e,
"once",a),function(b){b(la(a));b(r());return q})};e.fromArray=function(a){var b;Ca(a);return a.length?(b=0,new v(s(e,"fromArray",a),function(c){var d,g,f;f=!1;g=e.more;d=function(){var m;if(g!==e.noMore&&!f&&(m=a[b++],g=c(la(m)),g!==e.noMore))return b===a.length?c(r()):A.afterTransaction(d)};d();return function(){return f=!0}})):h(e,"fromArray",a,e.never())};e.mergeAll=function(){var a;a=1<=arguments.length?i.call(arguments,0):[];B(a[0])&&(a=a[0]);return a.length?new v(s.apply(null,[e,"mergeAll"].concat(i.call(a))),
function(b){var c,d;c=0;d=l.map(function(d){return function(f){return d.dispatcher.subscribe(function(d){if(d.isEnd())return c++,c===a.length?b(r()):e.more;d=b(d);d===e.noMore&&f();return d})}},a);return pa.apply(null,d)}):e.never()};e.zipAsArray=function(){var a;a=1<=arguments.length?i.call(arguments,0):[];B(a[0])&&(a=a[0]);return h.apply(null,[e,"zipAsArray"].concat(i.call(a),[e.zipWith(a,function(){return 1<=arguments.length?i.call(arguments,0):[]})]))};e.zipWith=function(){var a,b;a=arguments[0];
b=2<=arguments.length?i.call(arguments,1):[];t(a)||(a=[a,b[0]],b=a[0],a=a[1]);b=l.map(function(a){return a.toEventStream()},b);return h.apply(null,[e,"zipWith",a].concat(i.call(b),[e.when(b,a)]))};e.groupSimultaneous=function(){var a,b;b=1<=arguments.length?i.call(arguments,0):[];1===b.length&&B(b[0])&&(b=b[0]);var c,d,g;g=[];c=0;for(d=b.length;c<d;c++)a=b[c],g.push(new za(a));a=g;return h.apply(null,[e,"groupSimultaneous"].concat(i.call(b),[e.when(a,function(){return 1<=arguments.length?i.call(arguments,
0):[]})]))};e.combineAsArray=function(){var a,b,c,d,g;c=1<=arguments.length?i.call(arguments,0):[];1===c.length&&B(c[0])&&(c=c[0]);a=d=0;for(g=c.length;d<g;a=++d)b=c[a],U(b)||(c[a]=e.constant(b));if(c.length){g=[];b=0;for(d=c.length;b<d;b++)a=c[b],g.push(new z(a,!0));a=g;return h.apply(null,[e,"combineAsArray"].concat(i.call(c),[e.when(a,function(){return 1<=arguments.length?i.call(arguments,0):[]}).toProperty()]))}return e.constant([])};e.onValues=function(){var a,b;b=2<=arguments.length?i.call(arguments,
0,a=arguments.length-1):(a=0,[]);a=arguments[a++];return e.combineAsArray(b).onValues(a)};e.combineWith=function(){var a,b;a=arguments[0];b=2<=arguments.length?i.call(arguments,1):[];return h.apply(null,[e,"combineWith",a].concat(i.call(b),[e.combineAsArray(b).map(function(b){return a.apply(null,b)})]))};e.combineTemplate=function(a){var b,c,d,g,f,m,j,i,k;m=[];k=[];f=function(a){return a[a.length-1]};i=function(a,b,c){return f(a)[b]=c};b=function(a,b){return function(c,d){return i(c,a,d[b])}};g=function(a,
b){return function(c){return i(c,a,b)}};j=function(a){return B(a)?[]:{}};c=function(a,c){var e,f;return U(c)?(k.push(c),m.push(b(a,k.length-1))):c===Object(c)&&"function"!==typeof c&&!(c instanceof RegExp)&&!(c instanceof Date)?(f=function(a){return function(b){var d;d=j(c);i(b,a,d);return b.push(d)}},e=function(a){return a.pop()},m.push(f(a)),d(c),m.push(e)):m.push(g(a,c))};d=function(a){return l.each(a,c)};d(a);return h(e,"combineTemplate",a,e.combineAsArray(k).map(function(b){var c,d,e,g,f;e=j(a);
c=[e];g=0;for(f=m.length;g<f;g++)d=m[g],d(c,b);return e}))};e.retry=function(a){var b,c,d,g,f,m;if(!t(a.source))throw new Q("'source' option has to be a function");m=a.source;g=a.retries||0;d=a.maxRetries||g;b=a.delay||function(){return 0};c=a.isRetryable||function(){return!0};f=function(a){var f;f={source:m,retries:g-1,maxRetries:d,delay:b,isRetryable:c};return e.later(b(a)).filter(!1).concat(e.once().flatMap(function(){return e.retry(f)}))};return h(e,"retry",a,m().flatMapError(function(a){return c(a)&&
0<g?f({error:a,retriesDone:d-g}):e.once(D(a))}))};Ja=0;k=function(){this.id=++Ja};k.prototype.isEvent=function(){return!0};k.prototype.isEnd=function(){return!1};k.prototype.isInitial=function(){return!1};k.prototype.isNext=function(){return!1};k.prototype.isError=function(){return!1};k.prototype.hasValue=function(){return!1};k.prototype.filter=function(){return!0};k.prototype.inspect=function(){return this.toString()};k.prototype.log=function(){return this.toString()};P=k;var u=function(a,b){u.__super__.constructor.call(this);
!b&&t(a)||a instanceof u?(this.valueF=a,this.valueInternal=void 0):(this.valueF=void 0,this.valueInternal=a)};o(u,P);u.prototype.isNext=function(){return!0};u.prototype.hasValue=function(){return!0};u.prototype.value=function(){this.valueF instanceof u?(this.valueInternal=this.valueF.value(),this.valueF=void 0):this.valueF&&(this.valueInternal=this.valueF(),this.valueF=void 0);return this.valueInternal};u.prototype.fmap=function(a){var b,c;if(this.valueInternal)return c=this.valueInternal,this.apply(function(){return a(c)});
b=this;return this.apply(function(){return a(b.value())})};u.prototype.apply=function(a){return new u(a)};u.prototype.filter=function(a){return a(this.value())};u.prototype.toString=function(){return l.toString(this.value())};u.prototype.log=function(){return this.value()};Y=u;var H=function(){return H.__super__.constructor.apply(this,arguments)};o(H,Y);H.prototype.isInitial=function(){return!0};H.prototype.isNext=function(){return!1};H.prototype.apply=function(a){return new H(a)};H.prototype.toNext=
function(){return new Y(this)};R=H;var M=function(){return M.__super__.constructor.apply(this,arguments)};o(M,P);M.prototype.isEnd=function(){return!0};M.prototype.fmap=function(){return this};M.prototype.apply=function(){return this};M.prototype.toString=function(){return"<end>"};na=M;k=function(a){this.error=a};o(k,P);k.prototype.isError=function(){return!0};k.prototype.fmap=function(){return this};k.prototype.apply=function(){return this};k.prototype.toString=function(){return"<error> "+l.toString(this.error)};
D=k;La=0;var j=function(a){this.id=++La;h(a,this);this.initialDesc=this.desc};j.prototype.subscribe=function(a){return A.wrappedSubscribe(this,a)};j.prototype.subscribeInternal=function(a){return this.dispatcher.subscribe(a)};j.prototype.onValue=function(){var a;a=F(arguments);return this.subscribe(function(b){if(b.hasValue())return a(b.value())})};j.prototype.onValues=function(a){return this.onValue(function(b){return a.apply(null,b)})};j.prototype.onError=function(){var a;a=F(arguments);return this.subscribe(function(b){if(b.isError())return a(b.error)})};
j.prototype.onEnd=function(){var a;a=F(arguments);return this.subscribe(function(b){if(b.isEnd())return a()})};j.prototype.errors=function(){return h(this,"errors",this.filter(function(){return!1}))};j.prototype.filter=function(){var a,b;b=arguments[0];a=2<=arguments.length?i.call(arguments,1):[];return T(this,b,a,function(a){return h(this,"filter",a,this.withHandler(function(b){return b.filter(a)?this.push(b):e.more}))})};j.prototype.takeWhile=function(){var a,b;b=arguments[0];a=2<=arguments.length?
i.call(arguments,1):[];return T(this,b,a,function(a){return h(this,"takeWhile",a,this.withHandler(function(b){if(b.filter(a))return this.push(b);this.push(r());return e.noMore}))})};j.prototype.endOnError=function(){var a,b;b=arguments[0];a=2<=arguments.length?i.call(arguments,1):[];null==b&&(b=!0);return T(this,b,a,function(a){return h(this,"endOnError",this.withHandler(function(b){return b.isError()&&a(b.error)?(this.push(b),this.push(r())):this.push(b)}))})};j.prototype.take=function(a){return 0>=
a?e.never():h(this,"take",a,this.withHandler(function(b){if(b.hasValue()){a--;if(0<a)return this.push(b);0===a&&this.push(b);this.push(r());return e.noMore}return this.push(b)}))};j.prototype.map=function(){var a,b;b=arguments[0];a=2<=arguments.length?i.call(arguments,1):[];return b instanceof E?b.sampledBy(this,Ka):T(this,b,a,function(a){return h(this,"map",a,this.withHandler(function(b){return this.push(b.fmap(a))}))})};j.prototype.mapError=function(){var a;a=F(arguments);return h(this,"mapError",
a,this.withHandler(function(b){return b.isError()?this.push(G(a(b.error))):this.push(b)}))};j.prototype.mapEnd=function(){var a;a=F(arguments);return h(this,"mapEnd",a,this.withHandler(function(b){return b.isEnd()?(this.push(G(a(b))),this.push(r()),e.noMore):this.push(b)}))};j.prototype.doAction=function(){var a;a=F(arguments);return h(this,"doAction",a,this.withHandler(function(b){b.hasValue()&&a(b.value());return this.push(b)}))};j.prototype.skip=function(a){return h(this,"skip",a,this.withHandler(function(b){return b.hasValue()&&
0<a?(a--,e.more):this.push(b)}))};j.prototype.skipDuplicates=function(a){null==a&&(a=function(a,c){return a===c});return h(this,"skipDuplicates",this.withStateMachine(w,function(b,c){return c.hasValue()?c.isInitial()||b===w||!a(b.get(),c.value())?[new K(c.value()),[c]]:[b,[]]:[b,[c]]}))};j.prototype.skipErrors=function(){return h(this,"skipErrors",this.withHandler(function(a){return a.isError()?e.more:this.push(a)}))};j.prototype.withStateMachine=function(a,b){var c;c=a;return h(this,"withStateMachine",
a,b,this.withHandler(function(a){var g,f,m,a=b(c,a);g=a[0];a=a[1];c=g;f=e.more;g=0;for(m=a.length;g<m&&!(f=a[g],f=this.push(f),f===e.noMore);g++);return f}))};j.prototype.scan=function(a,b){var c,d,b=ca(b);c=ua(a);var g=this;return d=new E(s(this,"scan",a,b),function(a){var m,h,j,i;m=!1;i=q;h=e.more;j=function(){if(!m)return c.forEach(function(b){m=!0;h=a(new R(function(){return b}));if(h===e.noMore)return i(),i=q})};i=g.dispatcher.subscribe(function(d){var g,i;if(d.hasValue()){if(m&&d.isInitial())return e.more;
d.isInitial()||j();m=!0;i=c.getOrElse(void 0);g=b(i,d.value());c=new K(g);return a(d.apply(function(){return g}))}d.isEnd()&&(h=j());if(h!==e.noMore)return a(d)});A.whenDoneWith(d,j);return i})};j.prototype.fold=function(a,b){return h(this,"fold",a,b,this.scan(a,b).sampledBy(this.filter(!1).mapEnd().toProperty()))};j.prototype.zip=function(a,b){null==b&&(b=Array);return h(this,"zip",a,e.zipWith([this,a],b))};j.prototype.diff=function(a,b){b=ca(b);return h(this,"diff",a,b,this.scan([a],function(a,
d){return[d,b(a[0],d)]}).filter(function(a){return 2===a.length}).map(function(a){return a[1]}))};j.prototype.flatMap=function(){return ha(this,$(arguments))};j.prototype.flatMapFirst=function(){return ha(this,$(arguments),!0)};j.prototype.flatMapWithConcurrencyLimit=function(){var a,b;b=arguments[0];a=2<=arguments.length?i.call(arguments,1):[];return h.apply(null,[this,"flatMapWithConcurrencyLimit",b].concat(i.call(a),[ha(this,$(a),!1,b)]))};j.prototype.flatMapLatest=function(){var a,b;a=$(arguments);
b=this.toEventStream();return h(this,"flatMapLatest",a,b.flatMap(function(c){return sa(a(c)).takeUntil(b)}))};j.prototype.flatMapError=function(a){return h(this,"flatMapError",a,this.mapError(function(a){return D(a)}).flatMap(function(b){return b instanceof D?a(b.error):e.once(b)}))};j.prototype.flatMapConcat=function(){return h.apply(null,[this,"flatMapConcat"].concat(i.call(arguments),[this.flatMapWithConcurrencyLimit.apply(this,[1].concat(i.call(arguments)))]))};j.prototype.bufferingThrottle=function(a){return h(this,
"bufferingThrottle",a,this.flatMapConcat(function(b){return e.once(b).concat(e.later(a).filter(!1))}))};j.prototype.not=function(){return h(this,"not",this.map(function(a){return!a}))};j.prototype.log=function(){var a;a=1<=arguments.length?i.call(arguments,0):[];this.subscribe(function(b){return"undefined"!==typeof console&&null!==console?"function"===typeof console.log?console.log.apply(console,i.call(a).concat([b.log()])):void 0:void 0});return this};j.prototype.slidingWindow=function(a,b){null==
b&&(b=0);return h(this,"slidingWindow",a,b,this.scan([],function(b,d){return b.concat([d]).slice(-a)}).filter(function(a){return a.length>=b}))};j.prototype.combine=function(a,b){var c;c=ca(b);return h(this,"combine",a,b,e.combineAsArray(this,a).map(function(a){return c(a[0],a[1])}))};j.prototype.decode=function(a){return h(this,"decode",a,this.combine(e.combineTemplate(a),function(a,c){return c[a]}))};j.prototype.awaiting=function(a){return h(this,"awaiting",a,e.groupSimultaneous(this,a).map(function(a){return 0===
a[1].length}).toProperty(!1).skipDuplicates())};j.prototype.name=function(a){this._name=a;return this};j.prototype.withDescription=function(){return s.apply(null,arguments).apply(this)};j.prototype.toString=function(){return this._name?this._name:this.desc.toString()};j.prototype.internalDeps=function(){return this.initialDesc.deps()};j.prototype.reduce=j.prototype.fold;j.prototype.assign=j.prototype.onValue;j.prototype.inspect=j.prototype.toString;ha=function(a,b,c,d){var g,f,h;h=[a];g=[];f=new v(s(a,
"flatMap"+(c?"First":""),b),function(f){var h,m,i,j,k;i=new fa;j=[];k=function(a){var c;c=sa(b(a.value()));g.push(c);return i.add(function(a,b){return c.dispatcher.subscribe(function(d){if(d.isEnd())return l.remove(c,g),m(),h(b),e.noMore;d instanceof R&&(d=d.toNext());d=f(d);d===e.noMore&&a();return d})})};m=function(){var a;if(a=j.shift())return k(a)};h=function(a){a();if(i.empty())return f(r())};i.add(function(b,g){return a.dispatcher.subscribe(function(a){return a.isEnd()?h(g):a.isError()?f(a):
c&&1<i.count()?e.more:i.unsubscribed?e.noMore:d&&i.count()>d?j.push(a):k(a)})});return i.unsubscribe});f.internalDeps=function(){return g.length?h.concat(g):h};return f};var p=function(a,b,c){t(a)&&(c=b,b=a,a=[]);p.__super__.constructor.call(this,a);Z(b);this.dispatcher=new ga(b,c);V(this)};o(p,j);p.prototype.delay=function(a){return h(this,"delay",a,this.flatMap(function(b){return e.later(a,b)}))};p.prototype.debounce=function(a){return h(this,"debounce",a,this.flatMapLatest(function(b){return e.later(a,
b)}))};p.prototype.debounceImmediate=function(a){return h(this,"debounceImmediate",a,this.flatMapFirst(function(b){return e.once(b).concat(e.later(a).filter(!1))}))};p.prototype.throttle=function(a){return h(this,"throttle",a,this.bufferWithTime(a).map(function(a){return a[a.length-1]}))};p.prototype.bufferWithTime=function(a){return h(this,"bufferWithTime",a,this.bufferWithTimeOrCount(a,Number.MAX_VALUE))};p.prototype.bufferWithCount=function(a){return h(this,"bufferWithCount",a,this.bufferWithTimeOrCount(void 0,
a))};p.prototype.bufferWithTimeOrCount=function(a,b){var c;c=function(c){if(c.values.length===b)return c.flush();if(void 0!==a)return c.schedule()};return h(this,"bufferWithTimeOrCount",a,b,this.buffer(a,c,c))};p.prototype.buffer=function(a,b,c){var d,g,f;null==b&&(b=q);null==c&&(c=q);d={scheduled:!1,end:void 0,values:[],flush:function(){var a;this.scheduled=!1;if(0<this.values.length){a=this.push(G(this.values));this.values=[];if(null!=this.end)return this.push(this.end);if(a!==e.noMore)return c(this)}else if(null!=
this.end)return this.push(this.end)},schedule:function(){if(!this.scheduled){this.scheduled=!0;var b=this;return a(function(){return b.flush()})}}};f=e.more;t(a)||(g=a,a=function(a){return e.scheduler.setTimeout(a,g)});return h(this,"buffer",this.withHandler(function(a){var c=this;d.push=function(a){return c.push(a)};if(a.isError())f=this.push(a);else if(a.isEnd()){d.end=a;d.scheduled||d.flush()}else{d.values.push(a.value());b(d)}return f}))};p.prototype.merge=function(a){Da(a);return h(this,"merge",
a,e.mergeAll(this,a))};p.prototype.toProperty=function(a){var b,c;c=0===arguments.length?w:ua(function(){return a});b=this.dispatcher;return new E(s(this,"toProperty",a),function(a){var g,f,h,i;g=!1;i=q;f=e.more;h=function(){if(!g)return c.forEach(function(b){g=!0;f=a(new R(b));if(f===e.noMore)return i(),i=q})};i=b.subscribe(function(b){if(b.hasValue()){if(g&&b.isInitial())return e.more;b.isInitial()||h();g=!0;c=new K(b);return a(b)}b.isEnd()&&(f=h());if(f!==e.noMore)return a(b)});h();return i})};
p.prototype.toEventStream=function(){return this};p.prototype.sampledBy=function(a,b){return h(this,"sampledBy",a,b,this.toProperty().sampledBy(a,b))};p.prototype.concat=function(a){var b;b=this;return new p(s(b,"concat",a),function(c){var d,e;e=q;d=b.dispatcher.subscribe(function(b){return b.isEnd()?e=a.dispatcher.subscribe(c):c(b)});return function(){d();return e()}})};p.prototype.takeUntil=function(a){var b;b={};return h(this,"takeUntil",a,e.groupSimultaneous(this.mapEnd(b),a.skipErrors()).withHandler(function(c){var d,
g,f;if(c.hasValue()){g=c.value();c=g[0];a=g[1];if(a.length)return this.push(r());d=e.more;g=0;for(f=c.length;g<f;g++)d=c[g],d=d===b?this.push(r()):this.push(G(d));return d}return this.push(c)}))};p.prototype.skipUntil=function(a){var b;b=a.take(1).map(!0).toProperty(!1);return h(this,"skipUntil",a,this.filter(b))};p.prototype.skipWhile=function(){var a,b,c;b=arguments[0];a=2<=arguments.length?i.call(arguments,1):[];c=!1;return T(this,b,a,function(a){return h(this,"skipWhile",a,this.withHandler(function(b){return c||
!b.hasValue()||!a(b.value())?(b.hasValue()&&(c=!0),this.push(b)):e.more}))})};p.prototype.holdWhen=function(a){var b,c,d;d=a.startWith(!1);c=d.filter(function(a){return!a});b=d.filter(l.id);return h(this,"holdWhen",a,this.filter(!1).merge(d.flatMapConcat(function(a){return function(d){return d?a.scan([],function(a,b){return a.concat(b)}).sampledBy(c).take(1).flatMap(e.fromArray):a.takeUntil(b)}}(this))))};p.prototype.startWith=function(a){return h(this,"startWith",a,e.once(a).concat(this))};p.prototype.withHandler=
function(a){return new p(s(this,"withHandler",a),this.dispatcher.subscribe,a)};v=p;var n=function(a,b,c){t(a)&&(c=b,b=a,a=[]);n.__super__.constructor.call(this,a);Z(b);this.dispatcher=new Ba(this,b,c);V(this)};o(n,j);n.prototype.sampledBy=function(a,b){var c,d;null!=b?b=ca(b):(c=!0,b=function(a){return a.value()});d=new z(this,!1,c);c=new z(a,!0,c);d=e.when([d,c],b);d=a instanceof n?d.toProperty():d;return h(this,"sampledBy",a,b,d)};n.prototype.sample=function(a){return h(this,"sample",a,this.sampledBy(e.interval(a,
{})))};n.prototype.changes=function(){var a=v,b=s(this,"changes"),c=this;return new a(b,function(a){return c.dispatcher.subscribe(function(b){if(!b.isInitial())return a(b)})})};n.prototype.withHandler=function(a){return new n(s(this,"withHandler",a),this.dispatcher.subscribe,a)};n.prototype.toProperty=function(){Ea(arguments);return this};n.prototype.toEventStream=function(){var a=v,b=s(this,"toEventStream"),c=this;return new a(b,function(a){return c.dispatcher.subscribe(function(b){b.isInitial()&&
(b=b.toNext());return a(b)})})};n.prototype.and=function(a){return h(this,"and",a,this.combine(a,function(a,c){return a&&c}))};n.prototype.or=function(a){return h(this,"or",a,this.combine(a,function(a,c){return a||c}))};n.prototype.delay=function(a){return this.delayChanges("delay",a,function(b){return b.delay(a)})};n.prototype.debounce=function(a){return this.delayChanges("debounce",a,function(b){return b.debounce(a)})};n.prototype.throttle=function(a){return this.delayChanges("throttle",a,function(b){return b.throttle(a)})};
n.prototype.delayChanges=function(){var a,b;a=2<=arguments.length?i.call(arguments,0,b=arguments.length-1):(b=0,[]);b=arguments[b++];return h.apply(null,[this].concat(i.call(a),[oa(this,b(this.changes()))]))};n.prototype.takeUntil=function(a){var b;b=this.changes().takeUntil(a);return h(this,"takeUntil",a,oa(this,b))};n.prototype.startWith=function(a){return h(this,"startWith",a,this.scan(a,function(a,c){return c}))};n.prototype.bufferingThrottle=function(){var a;return(a=n.__super__.bufferingThrottle.apply(this,
arguments)).bufferingThrottle.apply(a,arguments).toProperty()};E=n;T=function(a,b,c,d){if(b instanceof E)return a=b.sampledBy(a,function(a,b){return[a,b]}),d.call(a,function(a){return a[0]}).map(function(a){return a[1]});b=ka(b,c);return d.call(a,b)};oa=function(a,b){var c;c=new v(s(a,"justInitValue"),function(b){var g,f;f=void 0;g=a.dispatcher.subscribe(function(a){a.isEnd()||(f=a);return e.noMore});A.whenDoneWith(c,function(){null!=f&&b(f);return b(r())});return g});return c.concat(b).toProperty()};
k=function(a,b){this._subscribe=a;this._handleEvent=b;this.subscribe=L(this.subscribe,this);this.handleEvent=L(this.handleEvent,this);this.subscriptions=[];this.queue=[];this.ended=this.pushing=!1;this.unsubSrc=this.prevError=void 0};k.prototype.hasSubscribers=function(){return 0<this.subscriptions.length};k.prototype.removeSub=function(a){return this.subscriptions=l.without(a,this.subscriptions)};k.prototype.push=function(a){a.isEnd()&&(this.ended=!0);return A.inTransaction(a,this,this.pushIt,[a])};
k.prototype.pushToSubscriptions=function(a){var b,c,d,g,f;try{d=this.subscriptions;g=0;for(f=d.length;g<f;g++)c=d[g],b=c.sink(a),(b===e.noMore||a.isEnd())&&this.removeSub(c);return!0}catch(h){throw this.pushing=!1,this.queue=[],h;}};k.prototype.pushIt=function(a){if(this.pushing)return this.queue.push(a),e.more;if(a!==this.prevError){a.isError()&&(this.prevError=a);this.pushing=!0;this.pushToSubscriptions(a);for(this.pushing=!1;this.queue.length;)a=this.queue.shift(),this.push(a);if(this.hasSubscribers())return e.more;
this.unsubscribeFromSource();return e.noMore}};k.prototype.handleEvent=function(a){return this._handleEvent?this._handleEvent(a):this.push(a)};k.prototype.unsubscribeFromSource=function(){this.unsubSrc&&this.unsubSrc();return this.unsubSrc=void 0};k.prototype.subscribe=function(a){var b;if(this.ended)return a(r()),q;Z(a);b={sink:a};this.subscriptions.push(b);1===this.subscriptions.length&&(this.unsubSrc=this._subscribe(this.handleEvent),Z(this.unsubSrc));var c=this;return function(){c.removeSub(b);
if(!c.hasSubscribers())return c.unsubscribeFromSource()}};ga=k;var N=function(a,b,c){this.property=a;this.subscribe=L(this.subscribe,this);N.__super__.constructor.call(this,b,c);this.current=w;this.currentValueRootId=void 0;this.propertyEnded=!1};o(N,ga);N.prototype.push=function(a){a.isEnd()&&(this.propertyEnded=!0);a.hasValue()&&(this.current=new K(a),this.currentValueRootId=A.currentEventId());return N.__super__.push.call(this,a)};N.prototype.maybeSubSource=function(a,b){return b===e.noMore?q:
this.propertyEnded?(a(r()),q):ga.prototype.subscribe.call(this,a)};N.prototype.subscribe=function(a){var b,c,d;c=e.more;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded))b=A.currentEventId(),d=this.currentValueRootId,!this.propertyEnded&&d&&b&&b!==d?A.whenDoneWith(this.property,function(b){return function(){if(b.currentValueRootId===d)return a(ia(b.current.get().value()))}}(this)):A.inTransaction(void 0,this,function(){return c=a(ia(this.current.get().value()))},[]);return this.maybeSubSource(a,
c)};Ba=N;var x=function(){this.guardedSink=L(this.guardedSink,this);this.subscribeAll=L(this.subscribeAll,this);this.unsubAll=L(this.unsubAll,this);this.sink=void 0;this.subscriptions=[];this.ended=!1;x.__super__.constructor.call(this,s(e,"Bus"),this.subscribeAll)};o(x,v);x.prototype.unsubAll=function(){var a,b,c,d;d=this.subscriptions;b=0;for(c=d.length;b<c;b++)a=d[b],"function"===typeof a.unsub&&a.unsub()};x.prototype.subscribeAll=function(a){var b,c,d;this.sink=a;d=Ga(this.subscriptions);b=0;for(c=
d.length;b<c;b++)a=d[b],this.subscribeInput(a);return this.unsubAll};x.prototype.guardedSink=function(a){var b=this;return function(c){return c.isEnd()?(b.unsubscribeInput(a),e.noMore):b.sink(c)}};x.prototype.subscribeInput=function(a){return a.unsub=a.input.dispatcher.subscribe(this.guardedSink(a.input))};x.prototype.unsubscribeInput=function(a){var b,c,d,e,f;f=this.subscriptions;b=d=0;for(e=f.length;d<e;b=++d)if(c=f[b],c.input===a){"function"===typeof c.unsub&&c.unsub();this.subscriptions.splice(b,
1);break}};x.prototype.plug=function(a){var b;Fa(a);if(!this.ended){b={input:a};this.subscriptions.push(b);null!=this.sink&&this.subscribeInput(b);var c=this;return function(){return c.unsubscribeInput(a)}}};x.prototype.end=function(){this.ended=!0;this.unsubAll();return"function"===typeof this.sink?this.sink(r()):void 0};x.prototype.push=function(a){return"function"===typeof this.sink?this.sink(G(a)):void 0};x.prototype.error=function(a){return"function"===typeof this.sink?this.sink(D(a)):void 0};
k=x;var C=function(a,b,c){this.obs=a;this.sync=b;this.lazy=null!=c?c:!1;this.queue=[]};C.prototype.subscribe=function(a){return this.obs.dispatcher.subscribe(a)};C.prototype.toString=function(){return this.obs.toString()};C.prototype.markEnded=function(){return this.ended=!0};C.prototype.consume=function(){return this.lazy?{value:l.always(this.queue[0])}:this.queue[0]};C.prototype.push=function(a){return this.queue=[a]};C.prototype.mayHave=function(){return!0};C.prototype.hasAtLeast=function(){return this.queue.length};
C.prototype.flatten=!0;z=C;var I=function(){return I.__super__.constructor.apply(this,arguments)};o(I,z);I.prototype.consume=function(){return this.queue.shift()};I.prototype.push=function(a){return this.queue.push(a)};I.prototype.mayHave=function(a){return!this.ended||this.queue.length>=a};I.prototype.hasAtLeast=function(a){return this.queue.length>=a};I.prototype.flatten=!1;Aa=I;var W=function(a){W.__super__.constructor.call(this,a,!0)};o(W,z);W.prototype.consume=function(){var a;a=this.queue;this.queue=
[];return{value:function(){return a}}};W.prototype.push=function(a){return this.queue.push(a.value())};W.prototype.hasAtLeast=function(){return!0};za=W;z.isTrigger=function(a){return a instanceof z?a.sync:a instanceof v};z.fromObservable=function(a){return a instanceof z?a:a instanceof E?new z(a,!1):new Aa(a,!0)};s=function(){var a,b,c;b=arguments[0];c=arguments[1];a=3<=arguments.length?i.call(arguments,2):[];return(b||c)instanceof ma?b||c:new ma(b,c,a)};qa=function(a){return B(a)?l.flatMap(qa,a):
U(a)?[a]:a instanceof z?[a.obs]:[]};o=function(a,b,c){this.context=a;this.method=b;this.args=c;this.cached=void 0};o.prototype.deps=function(){return this.cached||(this.cached=qa([this.context].concat(this.args)))};o.prototype.apply=function(a){a.desc=this;return a};o.prototype.toString=function(){return l.toString(this.context)+"."+l.toString(this.method)+"("+l.map(l.toString,this.args)+")"};ma=o;h=function(){var a,b;a=2<=arguments.length?i.call(arguments,0,b=arguments.length-1):(b=0,[]);b=arguments[b++];
return s.apply(null,a).apply(b)};e.when=function(){var a,b,c,d,g,f,h,j,k,p,o,n,q,t,u,x,y,w;if(0===arguments.length)return e.never();d=arguments.length;S("when: expecting arguments in the form (Observable+,function)+",0===d%2);n=[];j=[];b=0;for(k=[];b<d;){k[b]=arguments[b];k[b+1]=arguments[b+1];h=l.toArray(arguments[b]);a=Ha(arguments[b+1]);f={f:a,ixs:[]};q=!1;t=0;for(x=h.length;t<x;t++){o=h[t];a=l.indexOf(n,o);q||(q=z.isTrigger(o));0>a&&(n.push(o),a=n.length-1);w=f.ixs;u=0;for(y=w.length;u<y;u++)c=
w[u],c.index===a&&c.count++;f.ixs.push({index:a,count:1})}S("At least one EventStream required",q||!h.length);0<h.length&&j.push(f);b+=2}if(!n.length)return e.never();n=l.map(z.fromObservable,n);g=l.any(n,function(a){return a.flatten})&&Ia(l.map(function(a){return a.obs},n));return p=new v(s.apply(null,[e,"when"].concat(i.call(k))),function(a){var c,d,f,h,i,k,m;m=[];f=!1;h=function(a){var c,d;d=a.ixs;a=0;for(c=d.length;a<c;a++)if(b=d[a],!n[b.index].hasAtLeast(b.count))return!1;return!0};d=function(a){return!a.sync||
a.ended};c=function(a){var c,d;d=a.ixs;a=0;for(c=d.length;a<c;a++)if(b=d[a],!n[b.index].mayHave(b.count))return!0};i=function(a){return!a.source.flatten};k=function(k){return function(o){var q,s,t;s=function(){return A.whenDoneWith(p,q)};t=function(){var c,d,f,g,k;if(0<m.length){f=e.more;f=m.pop();g=0;for(k=j.length;g<k;g++)if(d=j[g],h(d)){var o=k=g=void 0,p=void 0,o=d.ixs,p=[];g=0;for(k=o.length;g<k;g++)b=o[g],p.push(n[b.index].consume());c=p;f=a(f.e.apply(function(){var a,b,e,f;f=[];b=0;for(e=c.length;b<
e;b++)a=c[b],f.push(a.value());return d.f.apply(d,f)}));m.length&&(m=l.filter(i,m));return f===e.noMore?f:t()}}else return e.more};q=function(){var b;b=t();if(f&&(f=!1,l.all(n,d)||l.all(j,c)))b=e.noMore,a(r());b===e.noMore&&o();return b};return k.subscribe(function(b){var c;b.isEnd()?(f=!0,k.markEnded(),s()):b.isError()?c=a(b):(k.push(b),k.sync&&(m.push({source:k,e:b}),g||A.hasWaiters()?s():q()));c===e.noMore&&o();return c||e.more})}};return pa.apply(null,function(){var a,b,c;c=[];a=0;for(b=n.length;a<
b;a++)o=n[a],c.push(k(o));return c}())})};Ia=function(a,b){var c;null==b&&(b=[]);c=function(a){var e;if(l.contains(b,a))return!0;e=a.internalDeps();if(e.length)return b.push(a),l.any(e,c);b.push(a);return!1};return l.any(a,c)};e.update=function(){var a,b,c,d;b=arguments[0];d=2<=arguments.length?i.call(arguments,1):[];c=function(a){return function(){var b;b=1<=arguments.length?i.call(arguments,0):[];return function(c){return a.apply(null,[c].concat(b))}}};for(a=d.length-1;0<a;)d[a]instanceof Function||
(d[a]=function(a){return function(){return a}}(d[a])),d[a]=c(d[a]),a-=2;return h.apply(null,[e,"update",b].concat(i.call(d),[e.when.apply(e,d).scan(b,function(a,b){return b(a)})]))};pa=function(){var a;a=1<=arguments.length?i.call(arguments,0):[];return(new fa(a)).unsubscribe};o=function(a){var b,c,d;null==a&&(a=[]);this.unsubscribe=L(this.unsubscribe,this);this.unsubscribed=!1;this.subscriptions=[];this.starting=[];c=0;for(d=a.length;c<d;c++)b=a[c],this.add(b)};o.prototype.add=function(a){var b,
c;if(!this.unsubscribed){b=!1;c=q;this.starting.push(a);var d=this;c=a(this.unsubscribe,function(){if(!d.unsubscribed)return b=!0,d.remove(c),l.remove(a,d.starting)});!this.unsubscribed&&!b&&this.subscriptions.push(c);l.remove(a,this.starting);return c}};o.prototype.remove=function(a){if(!this.unsubscribed&&void 0!==l.remove(a,this.subscriptions))return a()};o.prototype.unsubscribe=function(){var a,b,c,d;if(!this.unsubscribed){this.unsubscribed=!0;d=this.subscriptions;b=0;for(c=d.length;b<c;b++)a=
d[b],a();this.subscriptions=[];return this.starting=[]}};o.prototype.count=function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length};o.prototype.empty=function(){return 0===this.count()};fa=o;e.CompositeUnsubscribe=fa;var y=function(a){this.value=a};y.prototype.getOrElse=function(){return this.value};y.prototype.get=function(){return this.value};y.prototype.filter=function(a){return a(this.value)?new y(this.value):w};y.prototype.map=function(a){return new y(a(this.value))};
y.prototype.forEach=function(a){return a(this.value)};y.prototype.isDefined=!0;y.prototype.toArray=function(){return[this.value]};y.prototype.inspect=function(){return"Some("+this.value+")"};y.prototype.toString=function(){return this.inspect()};K=y;w={getOrElse:function(a){return a},filter:function(){return w},map:function(){return w},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}};var wa,da,ea,Ra,xa,ya,J,
O,X;J=void 0;O=[];X={};da=[];ea=0;wa=function(a){return J?da.push(a):a()};Ra=function(){for(;0<O.length;)ya(0)};ya=function(a){var b,c,d;b=O[a];c=b.id;d=X[c];O.splice(a,1);delete X[c];xa(b);b=0;for(c=d.length;b<c;b++)a=d[b],a()};xa=function(a){var b,c,d,a=a.internalDeps();c=0;for(d=a.length;c<d;c++)b=a[c],xa(b),X[b.id]&&(b=l.indexOf(O,b),ya(b))};A={whenDoneWith:function(a,b){var c;return J?(c=X[a.id],null==c?(X[a.id]=[b],O.push(a)):c.push(b)):b()},hasWaiters:function(){return 0<O.length},inTransaction:function(a,
b,c,d){var e;if(J)return c.apply(b,d);J=a;try{e=c.apply(b,d),Ra()}finally{for(J=void 0;ea<da.length;)a=da[ea],ea++,a();ea=0;da=[]}return e},currentEventId:function(){if(J)return J.id},wrappedSubscribe:function(a,b){var c,d,g,f;d=f=!1;c=function(){return d=!0};g=function(){f=!0;return c()};c=a.dispatcher.subscribe(function(a){return wa(function(){var c;if(!f&&(c=b(a),c===e.noMore))return g()})});d&&c();return g},afterTransaction:wa};e.EventStream=v;e.Property=E;e.Observable=j;e.Bus=k;e.Initial=R;e.Next=
Y;e.End=na;e.Error=D;q=function(){};Ka=function(a){return a};ia=function(a){return new R(a,!0)};G=function(a){return new Y(a,!0)};r=function(){return new na};la=function(a){return a instanceof P?a:G(a)};Ga=function(a){return a.slice(0)};S=function(a,b){if(!b)throw new Q(a);};Da=function(a){if(!(a instanceof v))throw new Q("not an EventStream : "+a);};Fa=function(a){if(!(a instanceof j))throw new Q("not an Observable : "+a);};Z=function(a){return S("not a function : "+a,t(a))};t=function(a){return"function"===
typeof a};B=function(a){return a instanceof Array};U=function(a){return a instanceof j};Ca=function(a){if(!B(a))throw new Q("not an array : "+a);};Ea=function(a){return S("no arguments supported",0===a.length)};ta=function(a,b){return function(){var c;c=1<=arguments.length?i.call(arguments,0):[];return a.apply(null,b.concat(c))}};$=function(a){return 1===a.length&&U(a[0])?l.always(a[0]):F(a)};F=function(a){a=Array.prototype.slice.call(a);return ra.apply(null,a)};ra=va(function(){var a,b;b=arguments[0];
a=2<=arguments.length?i.call(arguments,1):[];return t(b)?a.length?ta(b,a):b:ja(b)?Ma(b,a):l.always(b)});ka=function(a,b){return ra.apply(null,[a].concat(i.call(b)))};Ha=function(a){return t(a)?a:l.always(a)};sa=function(a){return U(a)?a:e.once(a)};ja=function(a){return"string"===typeof a&&1<a.length&&"."===a.charAt(0)};e.isFieldKey=ja;Ma=function(a,b){var c,d;d=a.slice(1).split(".");c=l.map(Oa(b),d);return function(b){var d,e;d=0;for(e=c.length;d<e;d++)a=c[d],b=a(b);return b}};Oa=function(a){return function(b){return function(c){var d;
if(null!=c)return d=c[b],t(d)?d.apply(c,a):d}}};Na=function(a){return a.slice(1)};ca=function(a){var b;return t(a)?a:ja(a)?(b=Na(a),function(a,d){return a[b](d)}):S("not a function or a field key: "+a,!1)};ua=function(a){return a instanceof K||a===w?a:new K(a)};"undefined"!==typeof define&&null!==define&&null!=define.amd?(define([],function(){return e}),this.Bacon=e):"undefined"!==typeof module&&null!==module&&null!=module.exports?(module.exports=e,e.Bacon=e):this.Bacon=e}).call(this);